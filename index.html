<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffcc00">
    <meta name="description" content="–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è CrossFit —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./sw.js')
            .then(registration => {
              console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
            })
            .catch(error => {
              console.log('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
            });
        });
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
      window.addEventListener('beforeinstallprompt', (event) => {
        event.preventDefault();
        window.deferredPrompt = event;
        console.log('PWA –≥–æ—Ç–æ–≤–æ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ');
      });
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–†–£–ë–ò–ù–ß–ò–ö –ö–ê–ß–ê–õ–ö–ê</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }
        
        .header {
            text-align: center;
            padding: 15px 0;
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .header h1 {
            font-size: 2.8rem;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 8px;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
        }
        
        .header p {
            font-size: 1.4rem;
        }
        
        .panels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            flex: 1;
            min-width: 300px;
        }
        
        .panel h2 {
            color: #ffcc00;
            margin-bottom: 12px;
            text-align: center;
            font-size: 1.8rem;
            border-bottom: 2px solid #ffcc00;
            padding-bottom: 8px;
        }
        
        .setting-group {
            margin-bottom: 15px;
        }
        
        .setting-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .setting-group input, 
        .setting-group select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }
        
        .button {
            background: linear-gradient(to right, #ff8c00, #ffcc00);
            color: #1a1a1a;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.4);
        }
        
        .button:active {
            transform: translateY(1px);
        }
        
        .name-input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .name-input {
            flex: 3;
        }
        
        .emoji-select {
            flex: 1;
            padding: 10px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
        }
        
        /* –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–õ–û–ö - —É—á–∞—Å—Ç–Ω–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–º–µ—â–∞—Ç—å—Å—è –≤ —ç–∫—Ä–∞–Ω */
        #participantsContainer {
            display: grid;
            gap: 15px;
            margin-bottom: 15px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
            min-height: 300px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ–ª–∏—á–µ—Å—Ç–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π */
        .session_progress {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .four-participants {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .three-participants {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .participant {
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            min-height: 280px;
            overflow: hidden;
        }
        
        .photo {
            position: relative;
            height: 120px;
            margin-bottom: 12px;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .participant-emoji {
            font-size: 4rem;
            text-align: center;
        }
        
        .participant-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 6px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .progress-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 140px;
        }
        
        .progress-bar-container {
            height: 22px;
            background: #333;
            border-radius: 11px;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
            flex-shrink: 0;
        }
        
        .progress-bar {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 11px;
        }
        
        .progress-text {
            text-align: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 90px;
        }
        
        .progress-text p {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            line-height: 1.3;
            word-break: break-word;
        }
        
        .emoji-large {
            font-size: 3.5rem;
            display: block;
        }
        
        .participant-time {
            font-size: 1rem;
            color: #ffcc00;
            margin-top: 5px;
            font-weight: bold;
        }
        
        .timer-display {
            text-align: center;
            font-size: 2.8rem;
            font-weight: bold;
            margin: 15px 0;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            letter-spacing: 3px;
        }
        
        .timer-settings {
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }
        
        .timer-settings input {
            flex: 1;
            text-align: center;
            font-size: 1.2rem;
        }
        
        .info-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }
        
        .info-item {
            margin: 10px 0;
            font-size: 1.2rem;
        }
        
        .exercise-list {
            list-style-type: none;
            margin: 12px 0;
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
        }
        
        .exercise-list li {
            padding: 10px;
            margin-bottom: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
        }
        
        .remove-exercise-btn {
            background: #ff5252;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }
        
        .controls button {
            flex: 1;
        }
        
        .instructions {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .instructions h3 {
            color: #ffcc00;
            margin-bottom: 12px;
            text-align: center;
            font-size: 1.5rem;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
            font-size: 1.1rem;
        }
        
        /* –ú–ï–î–ò–ê-–ó–ê–ü–†–û–°–´ –î–õ–Ø –ê–î–ê–ü–¢–ê–¶–ò–ò –ö –¢–í */
        
        /* –î–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ (Full HD –∏ –≤—ã—à–µ) */
        @media (min-width: 1920px) {
            .container {
                max-width: 95vw;
                padding: 15px;
            }
            
            #participantsContainer {
                gap: 20px;
            }
            
            .participant {
                min-height: 320px;
                padding: 20px;
            }
            
            .photo {
                height: 140px;
            }
            
            .participant-emoji {
                font-size: 5rem;
            }
            
            .progress-bar-container {
                height: 25px;
            }
            
            .progress-text p {
                font-size: 1.4rem;
            }
            
            .header h1 {
                font-size: 3.5rem;
            }
            
            .button {
                padding: 16px;
                font-size: 1.3rem;
            }
        }
        
        /* –î–ª—è 4K —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (min-width: 3840px) {
            body {
                font-size: 1.5rem;
            }
            
            .container {
                max-width: 90vw;
                padding: 30px;
            }
            
            #participantsContainer {
                gap: 30px;
            }
            
            .participant {
                min-height: 450px;
                padding: 30px;
                border-radius: 20px;
            }
            
            .photo {
                height: 180px;
                border-radius: 15px;
            }
            
            .participant-emoji {
                font-size: 7rem;
            }
            
            .participant-name {
                font-size: 1.8rem;
                padding: 10px;
            }
            
            .progress-bar-container {
                height: 35px;
                border-radius: 17px;
            }
            
            .progress-text p {
                font-size: 1.8rem;
                min-height: 120px;
            }
            
            .progress-text {
                min-height: 150px;
            }
            
            .header h1 {
                font-size: 5rem;
                margin-bottom: 15px;
            }
            
            .header p {
                font-size: 2rem;
            }
            
            .button {
                padding: 25px;
                font-size: 1.8rem;
                border-radius: 12px;
            }
            
            .setting-group label {
                font-size: 1.6rem;
            }
            
            .setting-group input,
            .setting-group select {
                padding: 18px;
                font-size: 1.6rem;
                border-radius: 12px;
            }
            
            .timer-display {
                font-size: 4rem;
                padding: 25px;
            }
        }
        
        /* –î–ª—è —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ –∏–ª–∏ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            .session_progress {
                grid-template-columns: 1fr;
            }
            
            .three-participants {
                grid-template-columns: 1fr;
            }
            
            .panels-container {
                flex-direction: column;
            }
            
            .participant {
                min-height: 250px;
            }
        }
        
        /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è —à–∏—Ä–∏–Ω—ã –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ */
        @media (max-width: 1200px) {
            .session_progress.four-participants {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .session_progress.three-participants {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 900px) {
            .session_progress.four-participants,
            .session_progress.three-participants {
                grid-template-columns: 1fr;
            }
            
            .participant {
                min-height: 200px;
            }
            
            .photo {
                height: 100px;
            }
            
            .participant-emoji {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–ö–†–û–°–§–ò–ù–ö–¢–ï–†–´ –ü–ï–î–ò–ö–ò</h1>
            <p id="currentDate"></p>
        </div>
        
        <div class="panels-container">
            <div class="panel">
                <h2>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
                <div class="setting-group">
                    <label for="participantCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</label>
                    <select id="participantCount" onchange="updateParticipants()">
                        <option value="2">2 —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>
                        <option value="3">3 —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>
                        <option value="4" selected>4 —É—á–∞—Å—Ç–Ω–∏–∫–∞</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label>–ò–º–µ–Ω–∞ –∏ —ç–º–æ–¥–∑–∏:</label>
                    <div id="nameInputsContainer"></div>
                    <button class="button" onclick="applyNames()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–º–µ–Ω–∞</button>
                </div>
            </div>
            
            <div class="panel">
                <h2>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</h2>
                <div class="setting-group">
                    <label for="exerciseSelect">–î–æ–±–∞–≤–∏—Ç—å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ:</label>
                    <select id="exerciseSelect">
                        <option value="–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è">–ü—Ä–∏—Å–µ–¥–∞–Ω–∏—è</option>
                        <option value="–û—Ç–∂–∏–º–∞–Ω–∏—è">–û—Ç–∂–∏–º–∞–Ω–∏—è</option>
                        <option value="–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è">–ü–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è</option>
                        <option value="–ë—É—Ä–ø–∏">–ë—É—Ä–ø–∏</option>
                        <option value="–ü—Ä—ã–∂–∫–∏ –Ω–∞ —Å–∫–∞–∫–∞–ª–∫–µ">–ü—Ä—ã–∂–∫–∏ –Ω–∞ —Å–∫–∞–∫–∞–ª–∫–µ</option>
                        <option value="–ë–µ–≥ –Ω–∞ –º–µ—Å—Ç–µ">–ë–µ–≥ –Ω–∞ –º–µ—Å—Ç–µ</option>
                        <option value="–°–∫–∞–ª–æ–ª–∞–∑">–°–∫–∞–ª–æ–ª–∞–∑</option>
                        <option value="–ü–ª–∞–Ω–∫–∞">–ü–ª–∞–Ω–∫–∞</option>
                        <option value="–í—ã–ø–∞–¥—ã">–í—ã–ø–∞–¥—ã</option>
                        <option value="–ü—Ä–µ—Å—Å">–ü—Ä–µ—Å—Å</option>
                    </select>
                    <button class="button" onclick="addExercise()">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                
                <div class="setting-group">
                    <label>–°–ø–∏—Å–æ–∫ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:</label>
                    <ul id="exerciseList" class="exercise-list"></ul>
                    <button class="button" onclick="clearExercises()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                </div>
                
                <div class="setting-group">
                    <label for="roundCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É–≥–æ–≤:</label>
                    <input type="number" id="roundCount" min="1" value="1">
                </div>
            </div>
            
            <div class="panel">
                <h2>–ö–æ–º–ø–ª–µ–∫—Å—ã</h2>
                <div class="setting-group">
                    <label for="complexSelect">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å:</label>
                    <select id="complexSelect">
                        <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å --</option>
                        <!-- –ö–æ–º–ø–ª–µ–∫—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–∫—Ä–∏–ø—Ç–æ–º -->
                    </select>
                    <button class="button" onclick="loadComplex()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                </div>
                
                <div class="setting-group">
                    <label>
                        <input type="checkbox" id="timerEnabled"> –í–∫–ª—é—á–∏—Ç—å —Ç–∞–π–º–µ—Ä
                    </label>
                    
                    <div id="timerSettings" style="display:none;">
                        <div class="timer-settings">
                            <input type="number" id="timerMinutes" min="0" max="59" value="10" placeholder="–ú–∏–Ω">
                            <input type="number" id="timerSeconds" min="0" max="59" value="0" placeholder="–°–µ–∫">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ë–ª–æ–∫ —Ç–∞–π–º–µ—Ä–∞ -->
        <div id="timerDisplay" class="timer-display" style="display:none;">
            <div id="timeLeft">10:00</div>
        </div>
        
        <!-- –ë–ª–æ–∫ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ -->
        <div id="totalDurationDisplay" class="timer-display" style="display:none;">
            <div>–û–±—â–µ–µ –≤—Ä–µ–º—è: <span id="totalDuration">00:00</span></div>
        </div>
        
        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –ë–õ–û–ö -->
        <div id="participantsContainer" class="session_progress four-participants"></div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="info-panel">
            <div class="info-item" id="start_time"></div>
            <div class="info-item" id="duration"></div>
            <div class="controls">
                <button class="button" onclick="resetProgressBars()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é</h3>
            <ul>
                <li><strong>–ö–ª–∞–≤–∏—à–∏ 1-4</strong> - –≤—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞/–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è</li>
                <li>–ù–∞–∂–º–∏—Ç–µ –∫–ª–∞–≤–∏—à—É —Å –Ω–æ–º–µ—Ä–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ</li>
                <li>–ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞—á–Ω–µ—Ç—Å—è –æ—Ç—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏</li>
                <li>–ü–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –Ω–∞–∂–∏–º–∞–π—Ç–µ –∫–ª–∞–≤–∏—à—É —É—á–∞—Å—Ç–Ω–∏–∫–∞</li>
                <li>–¶–≤–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é —É—á–∞—Å—Ç–Ω–∏–∫–∞: üü¢ - –ª–∏–¥–µ—Ä, üü° - —Å–µ—Ä–µ–¥–∏–Ω–∞, üî¥ - –æ—Ç—Å—Ç–∞—é—â–∏–π</li>
                <li>–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫–æ–º–ø–ª–µ–∫—Å–∞ —É—á–∞—Å—Ç–Ω–∏–∫ –æ—Ç–º–µ—á–∞–µ—Ç—Å—è —ç–º–æ–¥–∑–∏</li>
            </ul>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        let date_start = undefined;
        let start_triger = [];
        let flag = false;
        let flag_full_stop = false;
        let participantSteps = [];
        let participantNames = ['–£—á–∞—Å—Ç–Ω–∏–∫ 1', '–£—á–∞—Å—Ç–Ω–∏–∫ 2', '–£—á–∞—Å—Ç–Ω–∏–∫ 3', '–£—á–∞—Å—Ç–Ω–∏–∫ 4'];
        let participantEmojis = ['üòÄ', 'üòé', 'ü§©', 'üöÄ'];
        let exe = []; 
        let rounds = 1;
        let step = 0;
        let step_percent = 0;
        let participantCount = 4;
        let participantTimes = {};
        let finishedParticipants = 0;
        let isComplexFinished = false;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
        let timerEnabled = false;
        let timerInterval = null;
        let timerDuration = 600;
        let remainingTime = timerDuration;
        let totalDurationInterval = null;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º
        let isMusicPlaying = false;
        let isPlaceSoundPlaying = false;
        let currentSoundIndex = 1;
        let mainSoundsChainActive = false;

        // –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —ç–º–æ–¥–∑–∏
        const availableEmojis = [
            'üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 
            'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 
            'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü•∏', 
            'ü§©', 'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', 'üò£', 
            'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨', 
            'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó', 
            'ü§î', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 
            'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü§ê', 
            'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï', 'ü¶†', 'üí™', 'üëë', 
            'üèÜ', 'üöÄ', 'üî•', '‚≠ê', '‚ù§Ô∏è', 'üí•', 'üéØ', 'üèãÔ∏è', '‚õπÔ∏è', 'üèÉ'
        ];

        // 30 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö CrossFit –∫–æ–º–ø–ª–µ–∫—Å–æ–≤
        const crossfitComplexes = {
            'catching up': ['20 –≤—ã–ø–∞–¥–æ–≤ —Å –≥–∞–Ω—Ç–µ–ª—å—é –ú/–ñ 20/10 –∫–≥', '15 –ø—Ä—ã–∂–∫–æ–≤ –Ω–∞ —Ç—É–º–±—É –ú/–ñ Low/Low', '–ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è –ú/–ñ 10/5', 
                '15 –º–∞—Ö–∏ –≥–∏—Ä–∏ –ú/–ñ 24/12 –∫–≥', '20 –≤—ã–ø–∞–¥–æ–≤ —Å –≥–∞–Ω—Ç–µ–ª—å—é –ú/–ñ 20/10 –∫–≥', '10 –±–æ–ª–≥–∞—Ä—Å–∫–∏–π –ø—Ä–∏—Å–µ–¥ –ú/–ñ 20/10 –∫–≥', 
                '20 –±—Ä–æ—Å–∫–æ–≤ –º—è—á–∞ –ú/–ñ 9/6 –∫–≥', '10 —Ä—ã–≤–∫–æ–≤ –≥–∞–Ω—Ç–µ–ª–∏ –ú/–ñ 20/10 –∫–≥', '–±–µ–≥ –ú/–ñ 20/10 –∫–∞–ª–ª',
            ],
            'cindy': ['5 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '10 –æ—Ç–∂–∏–º–∞–Ω–∏–π', '15 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π'],
            'helen': ['400–º –±–µ–≥', '21 –º–∞—Ö –≥–∏—Ä–µ–π', '12 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π'],
            'nasty': ['50 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π', '7 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '10 –æ—Ç–∂–∏–º–∞–Ω–∏–π', '15 –º–∞—Ö–æ–≤ –≥–∏—Ä–µ–π'],
            'badger': ['30 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '30 —á–∏—Å—Ç—ã—Ö —à–≤—É–Ω–≥–æ–≤', '30 –ø—Ä—ã–∂–∫–æ–≤ –Ω–∞ —Ç—É–º–±—É', '800–º –±–µ–≥'],
            'fight': ['1 –º–∏–Ω—É—Ç–∞ –≤–µ–ª–æ—ç—Ä–≥–æ–º–µ—Ç—Ä', '1 –º–∏–Ω—É—Ç–∞ –ø—Ä—ã–∂–∫–∏ –Ω–∞ —Ç—É–º–±—É', '1 –º–∏–Ω—É—Ç–∞ –≥–∏—Ä—è', 
                      '1 –º–∏–Ω—É—Ç–∞ –±—Ä–æ—Å–∫–∏ –º—è—á–∞', '1 –º–∏–Ω—É—Ç–∞ –≥—Ä–µ–±–ª—è', '1 –º–∏–Ω—É—Ç–∞ –æ—Ç–¥—ã—Ö'],
            'fran': ['21-15-9 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', '21-15-9 —Ç—Ä–∞—Å—Ç–µ—Ä—ã'],
            'grace': ['30 —Ç—Ä–∞—Å—Ç–µ—Ä–æ–≤ (60–∫–≥)'],
            'isabel': ['30 —Ä—ã–≤–∫–æ–≤ (60–∫–≥)'],
            'diane': ['21-15-9 —Å—Ç–∞–Ω–æ–≤—ã–µ —Ç—è–≥–∏ (100–∫–≥)', '21-15-9 –æ—Ç–∂–∏–º–∞–Ω–∏—è –≤ —Å—Ç–æ–π–∫–µ'],
            'elizabeth': ['21-15-9 –≤–∑—è—Ç–∏—è –Ω–∞ –≥—Ä—É–¥—å (60–∫–≥)', '21-15-9 –æ—Ç–∂–∏–º–∞–Ω–∏—è –≤ —Å—Ç–æ–π–∫–µ'],
            'karen': ['150 –±—Ä–æ—Å–∫–æ–≤ –º—è—á–∞ –≤ –º–∏—à–µ–Ω—å (9–∫–≥)'],
            'mary': ['5 –æ—Ç–∂–∏–º–∞–Ω–∏–π –≤ —Å—Ç–æ–π–∫–µ', '10 –ø–∏—Å—Ç–æ–ª–µ—Ç–∏–∫–æ–≤', '15 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π'],
            'angie': ['100 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '100 –æ—Ç–∂–∏–º–∞–Ω–∏–π', '100 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π', '100 –ø—Ä–µ—Å—Å'],
            'jackie': ['1000–º –≥—Ä–µ–±–ª—è', '50 —Ç—Ä–∞—Å—Ç–µ—Ä–æ–≤ (20–∫–≥)', '30 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π'],
            'eva': ['800–º –±–µ–≥', '30 –≥–∏—Ä—å (32–∫–≥)', '30 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π'],
            'michael': ['800–º –±–µ–≥', '50 —Å–ø–∏—á–∞—Å—Ç–∏', '50 —Å–∫—Ä—É—á–∏–≤–∞–Ω–∏–π'],
            'amanda': ['9-7-5 —Ä—ã–≤–æ–∫ (60–∫–≥)', '9-7-5 –ø–æ–¥—ä–µ–º—ã –Ω–∞ –∫–æ–ª—å—Ü–∞—Ö'],
            'linda': ['10-9-8-7-6-5-4-3-2-1 —Å—Ç–∞–Ω–æ–≤–∞—è (100–∫–≥)', '1.5BW –∂–∏–º', '2BW –ø—Ä–∏—Å–µ–¥'],
            'chelenge': ['10 –º–∞—Ö–æ–≤ –≥–∏—Ä–µ–π', '10 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '10 –æ—Ç–∂–∏–º–∞–Ω–∏–π', '10 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π'],
            'dt': ['12 –≤–∑—è—Ç–∏–π –Ω–∞ –≥—Ä—É–¥—å (70–∫–≥)', '9 —Ç—Ä–∞—Å—Ç–µ—Ä–æ–≤ (70–∫–≥)', '6 —Ç–æ–ª—á–∫–æ–≤ (70–∫–≥)'],
            'filthy50': ['50 –ø—Ä—ã–∂–∫–æ–≤ –Ω–∞ –∫–æ—Ä–æ–±–∫—É', '50 –æ—Ç–∂–∏–º–∞–Ω–∏–π', '50 –ø–æ–¥—ä–µ–º–æ–≤ –∫–æ—Ä–ø—É—Å–∞', 
                         '50 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π', '50 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '50 –º–∞—Ö–æ–≤ –≥–∏—Ä–µ–π', '50 –≤—ã–ø–∞–¥–æ–≤', 
                         '50 –∂–∏–º–æ–≤ –≥–∞–Ω—Ç–µ–ª–µ–π', '50 –ø—Ä—ã–∂–∫–æ–≤ —Å–æ —Å–∫–∞–∫–∞–ª–∫–æ–π', '50 –±–µ—Ä–ø–∏'],
            'thechipper': ['100 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '100 –æ—Ç–∂–∏–º–∞–Ω–∏–π', '100 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π', '100 –ø—Ä–µ—Å—Å'],
            'murph': ['1 –º–∏–ª—è –±–µ–≥', '100 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '200 –æ—Ç–∂–∏–º–∞–Ω–∏–π', '300 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π', '1 –º–∏–ª—è –±–µ–≥'],
            'manion': ['7 —Ä–∞—É–Ω–¥–æ–≤: 400–º –±–µ–≥', '29 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π —Å–æ —à—Ç–∞–Ω–≥–æ–π (60–∫–≥)'],
            'kingkong': ['3 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è –¥–µ–¥–ª–∏—Ñ—Ç', '2 –∂–∏–º —à—Ç–∞–Ω–≥–∏ (100–∫–≥)', '1 —Ç—Ä–∞—Å—Ç–µ—Ä (100–∫–≥)'],
            'gwen': ['15-12-9 –≤–∑—è—Ç–∏—è –Ω–∞ –≥—Ä—É–¥—å (60–∫–≥)'],
            'josh': ['21 —Ç—Ä–∞—Å—Ç–µ—Ä—ã (40–∫–≥)', '21 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', '15 —Ç—Ä–∞—Å—Ç–µ—Ä—ã (40–∫–≥)', 
                     '15 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è', '9 —Ç—Ä–∞—Å—Ç–µ—Ä—ã (40–∫–≥)', '9 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏—è'],
            'danny': ['30 –±–µ—Ä–ø–∏', '400–º –±–µ–≥', '30 —Ç—Ä–∞—Å—Ç–µ—Ä—ã (40–∫–≥)', '800–º –±–µ–≥', '30 —Ç—Ä–∞—Å—Ç–µ—Ä—ã (40–∫–≥)', '400–º –±–µ–≥', '30 –±–µ—Ä–ø–∏'],
            'bay': ['30 –º–∞—Ö–æ–≤ –≥–∏—Ä–µ–π (32–∫–≥)', '30 —Ç—Ä–∞—Å—Ç–µ—Ä–æ–≤ (40–∫–≥)', '30 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', 
                    '30 –º–∞—Ö–æ–≤ –≥–∏—Ä–µ–π (32–∫–≥)', '30 —Ç—Ä–∞—Å—Ç–µ—Ä–æ–≤ (40–∫–≥)', '30 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π'],
            'hotshots': ['6 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '11 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π', '400–º –±–µ–≥', '6 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', 
                         '11 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π', '400–º –±–µ–≥', '6 –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π', '11 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π', '400–º –±–µ–≥']
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–æ–≤
        const sounds = {
            intro: new Howl({ 
                src: ['intro.mp3'], 
                loop: true, 
                volume: 1.0,
                onload: function() {
                    sounds.intro.play();
                    isMusicPlaying = true;
                }
            }),
            sound1: new Howl({ src: ['sound1.mp3'], volume: 1.0 }),
            sound2: new Howl({ src: ['sound2.mp3'], volume: 1.0 }),
            sound3: new Howl({ src: ['sound3.mp3'], volume: 1.0 }),
            sound4: new Howl({ src: ['sound4.mp3'], volume: 1.0 }),
            sound5: new Howl({ src: ['sound5.mp3'], volume: 1.0 }),
            sound6: new Howl({ src: ['sound6.mp3'], volume: 1.0 }),
            sound7: new Howl({ src: ['sound7.mp3'], volume: 1.0 }),
            sound8: new Howl({ src: ['sound8.mp3'], volume: 1.0 }),
            sound9: new Howl({ src: ['sound9.mp3'], volume: 1.0 }),
            sound10: new Howl({ src: ['sound10.mp3'], volume: 1.0 }),
            sound11: new Howl({ src: ['sound11.mp3'], volume: 1.0 }),
            sound12: new Howl({ src: ['sound12.mp3'], volume: 1.0 }),
            sound13: new Howl({ src: ['sound13.mp3'], volume: 1.0 }),
            sound14: new Howl({ src: ['sound14.mp3'], volume: 1.0 }),
            sound15: new Howl({ src: ['sound15.mp3'], volume: 1.0 }),
            end: new Howl({ src: ['end.mp3'], volume: 1.0 }),
            place1: new Howl({ src: ['place1.mp3'], volume: 1.0 }),
            place2: new Howl({ src: ['place2.mp3'], volume: 1.0 }),
            place3: new Howl({ src: ['place3.mp3'], volume: 1.0 }),
            place: new Howl({ src: ['place.mp3'], volume: 1.0 })
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –º–∞–∫–µ—Ç–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        function adaptParticipantsLayout() {
            const container = document.getElementById('participantsContainer');
            const containerWidth = container.offsetWidth;
            const participantCount = parseInt(document.getElementById('participantCount').value);
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            const minParticipantWidth = 350; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞
            const maxParticipantsPerRow = Math.floor(containerWidth / minParticipantWidth);
            
            let columns = participantCount;
            
            if (containerWidth < 900) {
                columns = 1;
            } else if (containerWidth < 1200) {
                columns = Math.min(2, participantCount);
            } else if (containerWidth < 1600) {
                columns = Math.min(participantCount, maxParticipantsPerRow);
            } else {
                // –î–ª—è –æ—á–µ–Ω—å —à–∏—Ä–æ–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤
                columns = Math.min(participantCount, 4);
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è —Å–µ—Ç–∫–∏
            container.className = 'session_progress';
            
            if (participantCount === 4) {
                container.classList.add('four-participants');
            } else if (participantCount === 3) {
                container.classList.add('three-participants');
            }
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫
            container.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;
            
            console.log(`–ê–¥–∞–ø—Ç–∞—Ü–∏—è: —à–∏—Ä–∏–Ω–∞ ${containerWidth}px, —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ${participantCount}, –∫–æ–ª–æ–Ω–æ–∫ ${columns}`);
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–ø–æ—á–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–≤—É–∫–æ–≤ (1-15)
        function setupSoundChain() {
            sounds.sound1.on('end', () => {
                currentSoundIndex = 2;
                sounds.sound2.play();
            });
            sounds.sound2.on('end', () => {
                currentSoundIndex = 3;
                sounds.sound3.play();
            });
            sounds.sound3.on('end', () => {
                currentSoundIndex = 4;
                sounds.sound4.play();
            });
            sounds.sound4.on('end', () => {
                currentSoundIndex = 5;
                sounds.sound5.play();
            });
            sounds.sound5.on('end', () => {
                currentSoundIndex = 6;
                sounds.sound6.play();
            });
            sounds.sound6.on('end', () => {
                currentSoundIndex = 7;
                sounds.sound7.play();
            });
            sounds.sound7.on('end', () => {
                currentSoundIndex = 8;
                sounds.sound8.play();
            });
            sounds.sound8.on('end', () => {
                currentSoundIndex = 9;
                sounds.sound9.play();
            });
            sounds.sound9.on('end', () => {
                currentSoundIndex = 10;
                sounds.sound10.play();
            });
            sounds.sound10.on('end', () => {
                currentSoundIndex = 11;
                sounds.sound11.play();
            });
            sounds.sound11.on('end', () => {
                currentSoundIndex = 12;
                sounds.sound12.play();
            });
            sounds.sound12.on('end', () => {
                currentSoundIndex = 13;
                sounds.sound13.play();
            });
            sounds.sound13.on('end', () => {
                currentSoundIndex = 14;
                sounds.sound14.play();
            });
            sounds.sound14.on('end', () => {
                currentSoundIndex = 15;
                sounds.sound15.play();
            });
            sounds.sound15.on('end', () => {
                currentSoundIndex = 1;
                sounds.sound1.play();
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—É–∑—ã –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–≤—É–∫–æ–≤
        function pauseMainSounds() {
            for (let i = 1; i <= 15; i++) {
                const soundKey = `sound${i}`;
                if (sounds[soundKey] && sounds[soundKey].playing()) {
                    sounds[soundKey].pause();
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–≤—É–∫–∞
        function resumeMainSound() {
            if (isComplexFinished) return;
            
            if (currentSoundIndex >= 1 && currentSoundIndex <= 15) {
                const soundKey = `sound${currentSoundIndex}`;
                if (sounds[soundKey] && !sounds[soundKey].playing()) {
                    sounds[soundKey].play();
                }
            }
        }

        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞ –º–µ—Å—Ç–∞
        function playPlaceSound(place) {
            if (isPlaceSoundPlaying || isComplexFinished) return;
            
            isPlaceSoundPlaying = true;
            pauseMainSounds();
            
            let placeSound;
            switch(place) {
                case 1:
                    placeSound = sounds.place1;
                    break;
                case 2:
                    placeSound = sounds.place2;
                    break;
                case 3:
                    placeSound = sounds.place3;
                    break;
                default:
                    placeSound = sounds.place;
            }
            
            placeSound.play();
            
            placeSound.on('end', () => {
                isPlaceSoundPlaying = false;
                if (!isComplexFinished) {
                    resumeMainSound();
                }
            });
        }

        // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        const participantsContainer = document.getElementById('participantsContainer');
        const nameInputsContainer = document.getElementById('nameInputsContainer');
        const exerciseList = document.getElementById('exerciseList');
        const exerciseSelect = document.getElementById('exerciseSelect');
        const roundCountInput = document.getElementById('roundCount');
        const participantCountSelect = document.getElementById('participantCount');
        const complexSelect = document.getElementById('complexSelect');
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã
        const now = new Date();
        const formattedDate = `${now.getDate().toString().padStart(2, '0')}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getFullYear()}`;
        document.getElementById('currentDate').textContent = formattedDate;

        // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        document.addEventListener('keydown', eventPressKey);
        roundCountInput.addEventListener('change', updateRoundCount);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function init() {
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ü–µ–ø–æ—á–∫—É –∑–≤—É–∫–æ–≤
            setupSoundChain();
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–ª–µ–∫—Å–æ–≤
            for (const complex in crossfitComplexes) {
                const option = document.createElement('option');
                option.value = complex;
                option.textContent = complex.charAt(0).toUpperCase() + complex.slice(1);
                complexSelect.appendChild(option);
            }
            
            updateParticipants();
            updateNameInputs();
            updateExerciseList();
            updateStep();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
            document.getElementById('timerEnabled').addEventListener('change', function() {
                timerEnabled = this.checked;
                const timerSettings = document.getElementById('timerSettings');
                const timerDisplay = document.getElementById('timerDisplay');
                
                if (timerEnabled) {
                    timerSettings.style.display = 'block';
                    timerDisplay.style.display = 'block';
                    updateTimerInputs();
                } else {
                    timerSettings.style.display = 'none';
                    timerDisplay.style.display = 'none';
                    stopTimer();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ —Ç–∞–π–º–µ—Ä–∞
            document.getElementById('timerMinutes').addEventListener('change', updateTimerInputs);
            document.getElementById('timerSeconds').addEventListener('change', updateTimerInputs);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–¥–∞–ø—Ç–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
            adaptParticipantsLayout();
            window.addEventListener('resize', adaptParticipantsLayout);
            
            // –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
            setTimeout(() => {
                if (!sounds.intro.playing()) {
                    sounds.intro.play();
                    isMusicPlaying = true;
                }
            }, 1000);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ç–∞–π–º–µ—Ä–∞ –∏–∑ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
        function updateTimerInputs() {
            const minutes = parseInt(document.getElementById('timerMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('timerSeconds').value) || 0;
            
            timerDuration = minutes * 60 + seconds;
            remainingTime = timerDuration;
            updateTimerDisplay();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
        function updateTimerDisplay() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            document.getElementById('timeLeft').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
        function startTimer() {
            if (!timerEnabled) return;
            
            stopTimer();
            
            timerInterval = setInterval(() => {
                remainingTime--;
                updateTimerDisplay();
                
                if (remainingTime <= 0) {
                    endComplex();
                    stopTimer();
                }
            }, 1000);
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –æ—Ç—Å—á–µ—Ç–∞ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function startTotalDurationTimer() {
            const startTime = new Date();
            
            totalDurationInterval = setInterval(() => {
                const now = new Date();
                const duration = Math.floor((now - startTime) / 1000);
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                
                document.getElementById('totalDuration').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
            
            document.getElementById('totalDurationDisplay').style.display = 'block';
        }
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç—Å—á–µ—Ç–∞ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function stopTotalDurationTimer() {
            if (totalDurationInterval) {
                clearInterval(totalDurationInterval);
                totalDurationInterval = null;
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        function updateParticipants() {
            participantCount = parseInt(participantCountSelect.value);
            participantsContainer.innerHTML = '';
            
            participantSteps = [];
            start_triger = [];
            participantTimes = {};
            
            // –°–æ–∑–¥–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            for (let i = 0; i < participantCount; i++) {
                const participantId = String.fromCharCode(97 + i);
                const participant = document.createElement('div');
                participant.className = 'participant';
                participant.id = participantId;
                participant.innerHTML = `
                    <div class="photo">
                        <div class="participant-emoji">${participantEmojis[i]}</div>
                        <div class="participant-name">${participantNames[i]}</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="${participantId}_progress"></div>
                        </div>
                        <div class="progress-text">
                            <p>${exe.length > 0 ? exe[0] : '–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è'}</p>
                            <div class="participant-time" id="${participantId}_time"></div>
                        </div>
                    </div>
                `;
                participantsContainer.appendChild(participant);
                
                participantSteps.push(0);
                start_triger.push(0);
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–¥–∞–ø—Ç–∞—Ü–∏—é –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
            setTimeout(() => {
                adaptParticipantsLayout();
            }, 100);
            
            resetProgressBars();
            updateNameInputs();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω –∏ –≤—ã–±–æ—Ä–∞ —ç–º–æ–¥–∑–∏
        function updateNameInputs() {
            nameInputsContainer.innerHTML = '';
            
            for (let i = 0; i < participantCount; i++) {
                const nameRow = document.createElement('div');
                nameRow.className = 'name-input-row';
                
                const nameInput = document.createElement('input');
                nameInput.type = 'text';
                nameInput.className = 'name-input';
                nameInput.placeholder = `–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞ ${i+1}`;
                nameInput.value = participantNames[i] || '';
                nameInput.dataset.index = i;
                
                const emojiSelect = document.createElement('select');
                emojiSelect.className = 'emoji-select';
                emojiSelect.dataset.index = i;
                
                availableEmojis.forEach(emoji => {
                    const option = document.createElement('option');
                    option.value = emoji;
                    option.textContent = emoji;
                    if (emoji === participantEmojis[i]) {
                        option.selected = true;
                    }
                    emojiSelect.appendChild(option);
                });
                
                nameRow.appendChild(nameInput);
                nameRow.appendChild(emojiSelect);
                nameInputsContainer.appendChild(nameRow);
            }
        }

        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–º–µ–Ω –∏ —ç–º–æ–¥–∑–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        function applyNames() {
            const inputs = nameInputsContainer.querySelectorAll('.name-input');
            const selects = nameInputsContainer.querySelectorAll('.emoji-select');
            
            for (let i = 0; i < participantCount; i++) {
                if (i < inputs.length) {
                    participantNames[i] = inputs[i].value || `–£—á–∞—Å—Ç–Ω–∏–∫ ${i+1}`;
                    participantEmojis[i] = selects[i].value;
                }
            }
            
            updateParticipants();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫—Ä—É–≥–æ–≤
        function updateRoundCount() {
            rounds = parseInt(roundCountInput.value) || 1;
            updateStep();
            resetProgressBars();
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫
        function addExercise() {
            const selectedExercise = exerciseSelect.value;
            if (selectedExercise && !exe.includes(selectedExercise)) {
                exe.push(selectedExercise);
                updateExerciseList();
                updateStep();
                updateExerciseTextInProgressBars();
            } else {
                alert('–≠—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–æ–º–ø–ª–µ–∫—Å–∞
        function loadComplex() {
            const selectedComplex = complexSelect.value;
            if (!selectedComplex) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å!');
                return;
            }
            
            exe = [...crossfitComplexes[selectedComplex]];
            updateExerciseList();
            updateStep();
            updateExerciseTextInProgressBars();
            
            if (selectedComplex === 'cindy') {
                roundCountInput.value = 30;
            } else if (selectedComplex === 'helen' || selectedComplex === 'nasty' || 
                       selectedComplex === 'badger' || selectedComplex === 'fight') {
                roundCountInput.value = 3;
            } else {
                roundCountInput.value = 1;
            }
            updateRoundCount();
        }

        // –û—á–∏—Å—Ç–∫–∞ —Å–ø–∏—Å–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        function clearExercises() {
            exe = [];
            updateExerciseList();
            updateStep();
            resetProgressBars();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π
        function updateExerciseList() {
            exerciseList.innerHTML = '';
            exe.forEach((exercise, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="exercise-name">${index + 1}. ${exercise}</span>
                    <button class="remove-exercise-btn" onclick="removeExercise(${index})">–£–¥–∞–ª–∏—Ç—å</button>
                `;
                exerciseList.appendChild(li);
            });
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞
        function removeExercise(index) {
            exe.splice(index, 1);
            updateExerciseList();
            updateStep();
            resetProgressBars();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –≤ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞—Ö
        function updateExerciseTextInProgressBars() {
            const textElements = document.querySelectorAll('.progress-text p');
            const firstExercise = exe.length > 0 ? exe[0] : '–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è';
            
            textElements.forEach(p => {
                p.textContent = firstExercise;
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–≥–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateStep() {
            step = exe.length * rounds;
            step_percent = step > 0 ? 100 / step : 0;
        }

        // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
        function resetProgressBars() {
            isComplexFinished = false;
            participantSteps = new Array(participantCount).fill(0);
            flag = false;
            flag_full_stop = false;
            start_triger = new Array(participantCount).fill(0);
            participantTimes = {};
            finishedParticipants = 0;
            
            document.querySelectorAll('.progress-bar').forEach(bar => {
                bar.style.width = '0%';
                bar.style.backgroundColor = '#4CAF50';
            });
            
            const firstExercise = exe.length > 0 ? exe[0] : '–í—ã–±–µ—Ä–∏—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è';
            document.querySelectorAll('.progress-text p').forEach((p, i) => {
                if (i < participantCount) {
                    p.textContent = firstExercise;
                    p.className = '';
                }
            });
            
            document.querySelectorAll('.participant-time').forEach(timeElement => {
                timeElement.textContent = '';
            });
            
            document.getElementById('start_time').textContent = '';
            document.getElementById('duration').textContent = '';
            
            stopTimer();
            stopTotalDurationTimer();
            document.getElementById('totalDurationDisplay').style.display = 'none';
            
            if (timerEnabled) {
                remainingTime = timerDuration;
                updateTimerDisplay();
            }
            
            for (let i = 1; i <= 15; i++) {
                const soundKey = `sound${i}`;
                if (sounds[soundKey] && sounds[soundKey].playing()) {
                    sounds[soundKey].stop();
                }
            }
            if (sounds.end && sounds.end.playing()) {
                sounds.end.stop();
            }
            
            currentSoundIndex = 1;
            mainSoundsChainActive = false;
            
            if (!sounds.intro.playing()) {
                sounds.intro.play();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à
        function eventPressKey(event) {
            if(flag_full_stop) return false;
            
            for (let i = 0; i < participantCount; i++) {
                if (event.code === `Digit${i+1}`) {
                    unlock(i);
                }
            }
            
            if (!start_triger.every(val => val === 1)) return false;
            
            if(!flag) {
                if(exe.length === 0) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏!');
                    return false;
                }
                
                flag = true;
                setTimeBegin();
                
                sounds.intro.stop();
                sounds.sound1.play();
                mainSoundsChainActive = true;
                isMusicPlaying = true;
                return false;
            }
            
            for (let i = 0; i < participantCount; i++) {
                if (event.code === `Digit${i+1}`) {
                    handleParticipant(i, `${String.fromCharCode(97 + i)}_progress`);
                }
            }
            
            if(participantSteps.every(stepVal => stepVal === step)) {
                endComplex();
                flag_full_stop = true;
            }
        };

        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞
        function unlock(participantIndex) {
            if (participantIndex < participantCount) {
                start_triger[participantIndex] = 1;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞
        function handleParticipant(participantIndex, progressId) {
            if (participantIndex >= participantCount) return;
            
            let stepVar = participantSteps[participantIndex];
            
            if(stepVar >= step) return;
            stepVar++;
            
            participantSteps[participantIndex] = stepVar;
            
            changeBar(progressId, stepVar);
            updateExerciseText(participantIndex, stepVar);
            setColorPosition(progressId, stepVar, participantIndex);
            
            if(stepVar === step) {
                const participantId = String.fromCharCode(97 + participantIndex);
                const textElement = document.querySelectorAll('.progress-text p')[participantIndex];
                
                textElement.innerHTML = '<span class="emoji-large">üòé</span>';
                
                const date_end = new Date();
                const duration = date_end - date_start;
                participantTimes[participantId] = duration;
                
                const minutes = Math.floor(duration / 60000);
                const seconds = Math.floor((duration % 60000) / 1000);
                const timeText = `–í—Ä–µ–º—è: ${minutes} –º–∏–Ω ${seconds} —Å–µ–∫`;
                
                const timeElement = document.getElementById(`${participantId}_time`);
                if (timeElement) {
                    timeElement.textContent = timeText;
                }
                
                finishedParticipants++;
                const place = finishedParticipants;
                
                playPlaceSound(place);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
        function changeBar(id, stepValue) {
            const progress = document.getElementById(id);
            if (progress) {
                const percent = stepValue * step_percent;
                progress.style.width = percent + '%';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
        function updateExerciseText(participantIndex, stepVar) {
            if (stepVar < step && participantIndex < participantCount) {
                const textElements = document.querySelectorAll('.progress-text p');
                const exerciseIndex = stepVar % exe.length;
                if (exerciseIndex < exe.length && textElements[participantIndex]) {
                    const currentRound = Math.floor(stepVar / exe.length) + 1;
                    textElements[participantIndex].textContent = `${exe[exerciseIndex]} (–ö—Ä—É–≥ ${currentRound})`;
                    textElements[participantIndex].className = '';
                }
            }
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–∞ –ø–æ–∑–∏—Ü–∏–∏
        function setColorPosition(progressId, current, participantIndex) {
            const element = document.getElementById(progressId);
            if (!element) return;
            
            if (current === step) {
                element.style.backgroundColor = '#2196F3';
                return;
            }
            
            const others = [...participantSteps];
            others.splice(participantIndex, 1);
            
            const max = others.length > 0 ? Math.max(...others) : 0;
            const min = others.length > 0 ? Math.min(...others) : 0;
            
            if (current > max) {
                element.style.backgroundColor = '#4CAF50';
            } else if (current <= min) {
                element.style.backgroundColor = '#F44336';
            } else {
                element.style.backgroundColor = '#FFC107';
            }
        }

        function setTimeBegin() {
            date_start = new Date();
            const hours = date_start.getHours().toString().padStart(2, '0');
            const minutes = date_start.getMinutes().toString().padStart(2, '0');
            const seconds = date_start.getSeconds().toString().padStart(2, '0');
            document.getElementById('start_time').textContent = `–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞: ${hours}:${minutes}:${seconds}`;
            
            startTimer();
            startTotalDurationTimer();
            
            setTimeout(() => {
                document.getElementById('participantsContainer').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center'
                });
            }, 500);
        }

        function endComplex() {
            isComplexFinished = true;
            
            for (let i = 1; i <= 15; i++) {
                const soundKey = `sound${i}`;
                if (sounds[soundKey] && sounds[soundKey].playing()) {
                    sounds[soundKey].stop();
                }
            }
            
            if (sounds.place.playing()) sounds.place.stop();
            if (sounds.place1.playing()) sounds.place1.stop();
            if (sounds.place2.playing()) sounds.place2.stop();
            if (sounds.place3.playing()) sounds.place3.stop();
            
            sounds.end.play();
            flag_full_stop = true;
            stopTimer();
            stopTotalDurationTimer();
            
            const date_end = new Date();
            const duration = date_end - date_start;
            const minutes = Math.floor(duration / 60000);
            const seconds = Math.floor((duration % 60000) / 1000);
            document.getElementById('duration').textContent = `–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${minutes} –º–∏–Ω—É—Ç ${seconds} —Å–µ–∫—É–Ω–¥`;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = init;
    </script>
</body>
</html>